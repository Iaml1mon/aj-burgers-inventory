{% extends 'base.html' %}

{% block content %}
<h2 class="page-title">Inventory Dashboard</h2>

{# Summary cards showing counts of each status #}
{% if grouped_items %}
    <div class="summary-cards">
        <div class="summary-card">
            <div class="title">Total Items</div>
            <div class="value">{{ total_items }}</div>
        </div>
        <div class="summary-card">
            <div class="title">Needs to Buy</div>
            <div class="value text-danger">{{ needs_count }}</div>
        </div>
        <div class="summary-card">
            <div class="title">Low Stock</div>
            <div class="value text-warning">{{ low_count }}</div>
        </div>
        <div class="summary-card">
            <div class="title">All Good</div>
            <div class="value text-success">{{ good_count }}</div>
        </div>
    </div>

    {# Category cards #}
    {% for category, data in grouped_items.items() %}
    <div class="card">
        <div class="card-header">{{ category }}</div>
        <div class="card-body">
            <div class="category-row">
                <div class="category-column">
                    <h6 class="text-danger">Needs to Buy</h6>
                    {% if data['needs'] %}
                        <ul class="list-group">
                            {% for item in data['needs'] %}
                                <li class="list-group-item">
                                    <div class="flex-between">
                                        <span>{{ item['item_name'] }}</span>
                                        <span class="text-danger">{{ item['quantity'] }}/{{ item['threshold'] }}</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-danger" style="width: 0%"></div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">Nothing to buy.</p>
                    {% endif %}
                </div>
                <div class="category-column">
                    <h6 class="text-warning">Low Stock</h6>
                    {% if data['low'] %}
                        <ul class="list-group">
                            {% for item in data['low'] %}
                                {% set percentage = (100 * item['quantity'] // item['threshold']) if item['threshold'] else 0 %}
                                <li class="list-group-item">
                                    <div class="flex-between">
                                        <span>{{ item['item_name'] }}</span>
                                        <span class="text-warning">{{ item['quantity'] }}/{{ item['threshold'] }}</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" style="width: {{ percentage }}%"></div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">All items above threshold.</p>
                    {% endif %}
                </div>
                <div class="category-column">
                    <h6 class="text-success">All Good</h6>
                    {% if data['good'] %}
                        <ul class="list-group">
                            {% for item in data['good'] %}
                                {% set percentage = (100 * item['quantity'] // item['threshold']) if item['threshold'] else 0 %}
                                <li class="list-group-item">
                                    <div class="flex-between">
                                        <span>{{ item['item_name'] }}</span>
                                        <span class="text-success">{{ item['quantity'] }}/{{ item['threshold'] }}</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" style="width: {{ percentage }}%"></div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No items meet or exceed threshold.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>No inventory data available.</p>
{% endif %}

{% endblock %}