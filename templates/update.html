{% extends 'base.html' %}

{% block title %}Inventory - AJ Burgers{% endblock %}

{% block content %}
  <h1 class="page-title">Update Inventory</h1>
  <!-- Search and filter row -->
  <div class="search-filter">
    <input type="text" id="search" class="search-input" placeholder="Search items or categories…" oninput="updateFilters()" />
    <div class="filter-buttons">
      <button type="button" class="filter-btn" data-filter="all" onclick="setFilter('all')">All</button>
      <button type="button" class="filter-btn" data-filter="needs" onclick="setFilter('needs')">Out of Stock</button>
      <button type="button" class="filter-btn" data-filter="low" onclick="setFilter('low')">Low Stock</button>
      <button type="button" class="filter-btn" data-filter="good" onclick="setFilter('good')">Good</button>
      <!-- Today’s Order shortcut links to order page -->
      <a href="{{ url_for('order') }}" class="filter-btn order-btn">Order Today</a>
    </div>
  </div>
  <form method="post" id="inventory-form">
    <div class="inventory-list">
      {% for item in items %}
      <div class="inventory-item-card {{ item.status }}" data-name="{{ item.item_name | lower }}" data-category="{{ item.category | lower }}" data-status="{{ item.status }}">
        <div class="item-header-single">
          <span class="item-name">{{ item.item_name }}</span>
          <small class="item-category">{{ item.category }}</small>
        </div>
        <div class="item-field">
          <label for="quantity_{{ item.id }}">Quantity</label>
          <input type="number" id="quantity_{{ item.id }}" name="quantity_{{ item.id }}" value="{{ item.quantity }}" min="0" />
        </div>
        <div class="item-field">
          <label for="threshold_{{ item.id }}">Threshold</label>
          <input type="number" id="threshold_{{ item.id }}" name="threshold_{{ item.id }}" value="{{ item.threshold }}" min="0" />
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="save-container">
      <button type="submit" class="btn-save btn-block">Save Changes</button>
    </div>
  </form>

  <script>
    // Filtering logic
    // Set initial filter from query parameter (default to 'all')
    let currentFilter = '{{ request.args.get("filter", "all") }}';
    function setFilter(filter) {
      currentFilter = filter;
      // Update active state on buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      updateFilters();
    }
    function updateFilters() {
      const searchTerm = document.getElementById('search').value.toLowerCase();
      document.querySelectorAll('.inventory-item-card').forEach(card => {
        const name = card.dataset.name;
        const category = card.dataset.category;
        const status = card.dataset.status;
        const matchSearch = name.includes(searchTerm) || category.includes(searchTerm);
        const matchFilter = currentFilter === 'all' || status === currentFilter;
        card.style.display = (matchSearch && matchFilter) ? '' : 'none';
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      // Set initial active filter button
      setFilter(currentFilter);
    });
  </script>
{% endblock %}