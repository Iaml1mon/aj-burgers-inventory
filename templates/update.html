{% extends 'base.html' %}

{% block content %}
<h2 class="page-title">Update Inventory</h2>

<!-- Search and filter controls -->
<div class="search-filter">
    <input type="text" id="searchInput" class="search-input" placeholder="Search items...">
    <div class="filter-group">
        <label><input type="radio" name="filterOptions" value="all" checked> All</label>
        <label><input type="radio" name="filterOptions" value="needs"> Needs</label>
        <label><input type="radio" name="filterOptions" value="low"> Low</label>
        <label><input type="radio" name="filterOptions" value="good"> Good</label>
    </div>
</div>

<!-- Inventory table for editing existing items -->
<div class="inventory-table-wrapper">
    <table class="inventory-table">
        <thead>
            <tr>
                <th>Category</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Threshold</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        {% for item in items %}
            {% set status = 'needs' if item['quantity'] <= 0 else ('low' if item['quantity'] < item['threshold'] else 'good') %}
            <tr data-status="{{ status }}" data-item-name="{{ item['item_name'] | lower }}">
                <form method="post">
                    <td>{{ item['category'] }}</td>
                    <td>{{ item['item_name'] }}</td>
                    <td>
                        <input type="number" name="quantity" value="{{ item['quantity'] }}" class="form-control" />
                    </td>
                    <td>
                        <input type="number" name="threshold" value="{{ item['threshold'] }}" class="form-control" />
                    </td>
                    <td>
                        <input type="hidden" name="update_id" value="{{ item['id'] }}" />
                        <button type="submit" class="btn btn-primary btn-sm">Update</button>
                    </td>
                </form>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- Form for adding a new item -->
<h3 class="subheading">Add New Item</h3>
<form method="post" action="{{ url_for('add_item') }}" class="add-item-form">
    <div class="form-row">
        <div class="form-group">
            <label for="item_name">Item Name</label>
            <input type="text" id="item_name" name="item_name" required />
        </div>
        <div class="form-group">
            <label for="category">Category</label>
            <select id="category" name="category" required>
                <option value="" disabled selected>Select category</option>
                {% for cat in categories %}
                <option value="{{ cat }}">{{ cat }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" placeholder="0" required />
        </div>
        <div class="form-group">
            <label for="threshold">Threshold (optional)</label>
            <input type="number" id="threshold" name="threshold" placeholder="Default" />
        </div>
        <div class="form-group form-group-button">
            <button type="submit" class="btn btn-success">Add</button>
        </div>
    </div>
</form>

    <!-- Search/filter script inside block content -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const filterRadios = document.querySelectorAll('input[name="filterOptions"]');
        const rows = document.querySelectorAll('tbody tr');

        function filterRows() {
            const query = searchInput.value.toLowerCase();
            const selectedFilter = document.querySelector('input[name="filterOptions"]:checked').value;
            rows.forEach(row => {
                const name = row.getAttribute('data-item-name');
                const status = row.getAttribute('data-status');
                const matchesQuery = name.includes(query);
                const matchesStatus = selectedFilter === 'all' || status === selectedFilter;
                if (matchesQuery && matchesStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        searchInput.addEventListener('input', filterRows);
        filterRadios.forEach(radio => radio.addEventListener('change', filterRows));
    });
    </script>

{% endblock %}